<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <title>n0chh Kick Live Stats — Top Chatter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
/* Social Media Buttons */
.social-links {
  display: flex;
  gap: 12px;
  margin-top: 12px;
}

.social-links a {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-color);
  font-size: 18px;
  text-decoration: none;
  transition: all 0.25s ease;
  border: 1px solid var(--border);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.social-links a:hover {
  transform: translateY(-2px);
  background: var(--accent);
  color: white;
  box-shadow: 0 6px 12px rgba(255, 105, 180, 0.4);
}

/* Custom Kick Icon (since FA doesn't have it) */
.social-links a[href*="kick.com"] i::before {
  content: "K";
  font-family: 'Inter', sans-serif;
  font-weight: 800;
  font-size: 16px;
}
.social-links a[href*="kick.com"] {
  background: linear-gradient(135deg, #333, #1a1a1a);
  color: white;
}
.social-links a[href*="kick.com"]:hover {
  background: linear-gradient(135deg, var(--accent), #ff85c0);
}
.raffle-rules {
  background: linear-gradient(135deg, rgba(15, 23, 36, 0.8), rgba(7, 16, 33, 0.9));
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 16px;
  padding: 20px;
  margin-top: 16px;
  font-size: 14px;
  color: #e6eef6;
  box-shadow: 
    0 4px 20px rgba(0, 0, 0, 0.3),
    inset 0 0 0 1px rgba(255, 255, 255, 0.03);
  position: relative;
  overflow: hidden;
  width: 100%;
}

.raffle-rules::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), #ff85c0, var(--accent));
  border-radius: 16px 16px 0 0;
}

.raffle-title {
  font-weight: 800;
  font-size: 18px;
  margin-bottom: 14px;
  color: white;
  display: flex;
  align-items: center;
  gap: 10px;
  text-shadow: 0 0 8px rgba(255, 105, 180, 0.3);
}

.raffle-rules ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.raffle-rules li {
  position: relative;
  padding-left: 30px;
  line-height: 1.5;
  opacity: 0.95;
  transition: opacity 0.2s;
}

.raffle-rules li:hover {
  opacity: 1;
}

.raffle-rules li::before {
  content: "✓";
  position: absolute;
  left: 0;
  top: 0;
  width: 20px;
  height: 20px;
  background: rgba(255, 105, 180, 0.15);
  border: 1.5px solid var(--accent);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
  color: var(--accent);
  font-family: 'Inter', sans-serif;
}

/* Optional: Add subtle glow on hover */
.raffle-rules li:hover::before {
  box-shadow: 0 0 8px rgba(255, 105, 180, 0.4);
}

/* Mobile optimization */
@media (max-width: 600px) {
  .raffle-rules {
    padding: 16px;
    font-size: 13px;
  }
  .raffle-title {
    font-size: 16px;
  }
  .raffle-rules li {
    padding-left: 26px;
    font-size: 13px;
  }
  .raffle-rules li::before {
    width: 18px;
    height: 18px;
    font-size: 11px;
  }
}
.text-emote-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 10px;
}

.text-emote-card {
  display: flex;
  align-items: center;
  padding: 14px 16px;
  border-radius: 12px;
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--border);
  transition: transform 0.2s, box-shadow 0.2s;
}

.text-emote-card:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(255,105,180,0.15);
}

.rank-number {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  margin-right: 12px;
  flex-shrink: 0;
  background: rgba(255,255,255,0.05);
  color: var(--text-color);
}

.rank-1 .rank-number { background: var(--gold); color: #000; }
.rank-2 .rank-number { background: var(--silver); color: #000; }
.rank-3 .rank-number { background: var(--bronze); color: #fff; }

.text-emote-content {
  flex: 1;
}
    :root{
      --bg:#071021;
      --card:#0f1724;
      --accent:#ff69b4;
      --muted:#98a0ab;
      --glass: rgba(255,255,255,0.03);
      --success:#10b981;
      --text-color: #e6eef6;
      --border: rgba(255,255,255,0.04);
      --gold: #FFD700;
      --silver: #C0C0C0;
      --bronze: #CD7F32;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:'Inter', system-ui, -apple-system, sans-serif;color:var(--text-color);background:linear-gradient(180deg,#03101a 0%, #071021 100%);-webkit-font-smoothing:antialiased}
    .wrap{max-width:1000px;margin:16px auto;padding:16px}
    
    /* Header Styles */
    .streamer-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
      padding: 24px;
      background: linear-gradient(135deg, rgba(15, 23, 36, 0.8), rgba(7, 16, 33, 0.9));
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    .streamer-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--accent);
      box-shadow: 0 0 20px rgba(255, 105, 180, 0.4);
    }
    .streamer-info {
      flex: 1;
    }
    .streamer-name {
      font-size: 32px;
      font-weight: 800;
      color: white;
      margin-bottom: 8px;
      text-shadow: 0 0 12px rgba(255, 105, 180, 0.5);
    }
    .streamer-title {
      font-size: 20px;
      color: var(--text-color);
      margin-bottom: 12px;
      font-weight: 600;
      line-height: 1.4;
    }
    .stream-stats {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .view-count {
      background: rgba(255, 255, 255, 0.05);
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .live-indicator-header {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 6px 14px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      font-size: 14px;
      font-weight: 600;
    }
    .live-dot-header {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .live-dot-header.live {
      background: var(--success);
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
    }
    .live-dot-header.off {
      background: var(--muted);
    }
    
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;justify-content:space-between}
    .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#d83a8c);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:15px;box-shadow:0 4px 12px rgba(255,105,180,0.3)}
    h1{font-size:28px;font-weight:800;margin:12px 0;color:#fff;text-shadow: 0 0 10px rgba(255,105,180,0.5);}
    .sub{color:var(--muted);font-size:14px;margin-top:4px}
    .giveaway-banner {
      background: linear-gradient(90deg, #ff69b4, #ff85c0);
      color: white;
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: bold;
      text-align: center;
      margin-top: 12px;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(255,105,180,0.3);
      width: 100%;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255,105,180,0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255,105,180,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,105,180,0); }
    }
    
    /* Controls */
    .controls{display:flex;gap:12px;align-items:center;margin-top:16px;flex-wrap:wrap;justify-content:space-between}
    input[type="text"]{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:var(--glass);color:inherit;min-width:180px;font-size:15px;width:100%}
    button{padding:12px 18px;border-radius:12px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(255,105,180,0.3);transition:all .2s ease;font-size:15px}
    button:hover, button:active{transform:scale(1.03);opacity:0.95}
    button.secondary{background:transparent;border:1px solid var(--border);color:var(--muted)}
    .live-indicator{display:inline-flex;gap:8px;align-items:center;padding:8px 16px;border-radius:24px;background:rgba(255,255,255,0.03);border:1px solid var(--border);font-size:14px}
    .live-dot{width:10px;height:10px;border-radius:50%}
    .live-dot.live{background:var(--success);box-shadow:0 0 10px rgba(16,185,129,0.4)}
    .live-dot.off{background:var(--muted)}
    
    /*top chatter red and gree*/
    .text-emote-card.text-dominant {
  background: rgba(16, 185, 129, 0.15); /* Green: text dominant */
  border-color: rgba(16, 185, 129, 0.4);
}

.text-emote-card.emote-dominant {
  background: rgba(239, 68, 68, 0.15); /* Red: emote dominant */
  border-color: rgba(239, 68, 68, 0.4);
}
.text-emote-card{
  background:rgba(255,255,255,0.02);
  border-radius:10px;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:6px;
  transition:transform 0.2s;
  border:1px solid var(--border);
}
    
    /* Cards */
    .card{background:rgba(255,255,255,0.02);border-radius:16px;padding:20px;margin-bottom:20px;border:1px solid var(--border);box-shadow:0 8px 20px rgba(0,0,0,0.25)}
    .small{font-size:13px;color:var(--muted)}
    .big-title{font-size:22px;font-weight:800;margin:16px 0 14px;color:#fff;display:flex;align-items:center;gap:10px}
    .stats-row{display:grid;grid-template-columns: repeat(auto-fit, minmax(110px,1fr));gap:14px;margin:16px 0}
    .stat-pill{padding:14px;border-radius:12px;background:rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(0,0,0,0.15)}
    .stat-pill .num{font-weight:800;font-size:20px;color:var(--accent)}
    .stat-pill .small{font-size:12px;text-align:center}
    
    /* Top Chatters Leaderboard */
    .leaderboard-container {
      position: relative;
      margin-top: 20px;
    }
    .chatter-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(280px,1fr));
      gap:16px;
      margin-top:10px;
    }
    .chatter-card{
      background:rgba(255,255,255,0.03);
      border-radius:14px;
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      transition:transform 0.3s, box-shadow 0.3s;
      border:1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    .chatter-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.05), transparent);
      z-index: -1;
    }
    .chatter-card:hover, .chatter-card:active{
      transform:scale(1.03);
      box-shadow:0 8px 20px rgba(255,105,180,0.2);
    }
    .chatter-card.rank-1 {
      background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,255,255,0.03));
      border: 2px solid var(--gold);
      box-shadow: 0 0 20px rgba(255,215,0,0.3);
    }
    .chatter-card.rank-2 {
      background: linear-gradient(135deg, rgba(192,192,192,0.12), rgba(255,255,255,0.03));
      border: 2px solid var(--silver);
      box-shadow: 0 0 20px rgba(192,192,192,0.2);
    }
    .chatter-card.rank-3 {
      background: linear-gradient(135deg, rgba(205,127,50,0.12), rgba(255,255,255,0.03));
      border: 2px solid var(--bronze);
      box-shadow: 0 0 20px rgba(205,127,50,0.2);
    }
    .rank-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 14px;
      color: white;
      z-index: 2;
    }
    .rank-1 .rank-badge { background: var(--gold); color: #333; }
    .rank-2 .rank-badge { background: var(--silver); color: #333; }
    .rank-3 .rank-badge { background: var(--bronze); }
    .username{font-weight:700;font-size:20px; display: flex; align-items: center; gap: 8px;}
    .message-count{font-weight:800;color:var(--accent);font-size:17px;}
    
    /* Emote Display */
    .emote-display {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .emote {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 12px;
    }
    
    /* Text vs Emotes Grid */
    .text-emote-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(280px,1fr));
      gap:16px;
      margin-top:10px;
    }
    .text-emote-card{
      background:rgba(255,255,255,0.03);
      border-radius:14px;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:8px;
      transition:transform 0.3s;
      border:1px solid var(--border);
    }
    .text-emote-card:hover, .text-emote-card:active{
      transform:scale(1.03);
      box-shadow:0 8px 20px rgba(255,105,180,0.2);
    }
    .text-emote-card .label{font-size:12px;color:var(--muted);}
    .text-emote-card .value{font-weight:700;font-size:15px;}
    .user-name{font-weight:700;font-size:16px;margin-bottom:6px;color:var(--text-color);}
    
    /* Emote Cloud */
    .emote-cloud{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .emote-pill{
      padding:8px 14px;
      border-radius:24px;
      background:rgba(255,255,255,0.05);
      font-size:14px;
      transition:transform 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .emote-pill:hover{transform:scale(1.08)}
    
    /* Footer */
    .footer{display:flex;justify-content:space-between;color:var(--muted);font-size:13px;margin-top:16px}
    
    /* Popup Styles */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .popup-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .popup-content {
      background: linear-gradient(145deg, #0f1724, #071021);
      border-radius: 20px;
      padding: 30px;
      width: 65%;
      max-width: 600px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      border: 1px solid var(--border);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    .popup-overlay.active .popup-content {
      transform: scale(1);
    }
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .popup-title {
      font-size: 44px;
      font-weight: 800;
      color: var(--accent);
    }
    .close-popup {
      background: rgba(255,255,255,0.1);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: var(--text-color);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-leaderboard {
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 10px;
    }
    .popup-leaderboard::-webkit-scrollbar {
      width: 8px;
    }
    .popup-leaderboard::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 4px;
    }
    .popup-leaderboard::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 4px;
    }
    
    /* Mobile Optimization */
    @media (max-width:768px){
      .streamer-header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }
      .streamer-avatar {
        width: 100px;
        height: 100px;
      }
      .streamer-name {
        font-size: 26px;
      }
      .streamer-title {
        font-size: 18px;
      }
      .stream-stats {
        justify-content: center;
      }
      .chatter-grid,
      .text-emote-grid{
        grid-template-columns: 1fr;
      }
      .controls button, input[type="text"]{
        flex:1;
        min-width:0;
      }
      .stats-row{
        grid-template-columns: repeat(2, 1fr);
      }
      .logo{width:44px;height:44px;font-size:14px}
      h1{font-size:24px}
      .big-title { font-size: 20px; }
    }
    @media (max-width:480px) {
      .streamer-avatar {
        width: 80px;
        height: 80px;
      }
      .streamer-name {
        font-size: 22px;
      }
      h1 { font-size: 20px; }
      .controls { flex-direction: column; }
      .giveaway-banner { padding: 6px 10px; font-size: 12px; }
    }
  </style>
</head>

<body>
<div style="max-width: 1000px; margin: 0 auto; width: 100%;">
    <img 
      src="https://i.ibb.co/qSJ3fQ7/Cartoon-Raffle-Logo-Roulette-Banner.jpg" 
      alt="Raffle Banner"
      style="width: 100%; height: auto; display: block;"
    />
  </div>

  <div class="wrap">
    <!-- rest of your page -->
  <div class="wrap">
    <!-- Streamer Header -->
    <div class="streamer-header">
      <img id="streamerAvatar" src="https://placehold.co/120x120/0f1724/ff69b4?text=N" alt="Streamer Avatar" class="streamer-avatar">
      <div class="streamer-info">
        <h2 id="streamerName" class="streamer-name">n0chh</h2>
        <div id="streamerTitle" class="streamer-title">—</div>
        <div class="stream-stats">
          <div class="view-count">
            <i class="fas fa-eye"></i>
            <span id="viewCount">0</span> viewers
          </div>
<button id="popupBtn" style="
  margin-top: 12px;
  padding: 8px 16px;
  background: linear-gradient(135deg, var(--accent), #ff85c0);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(255,105,180,0.3);
  display: inline-flex;
  align-items: center;
  gap: 6px;
">
  <i class="fas fa-trophy"></i> See Top 5 Chatters
</button>
          <div class="live-indicator-header">
            <div id="liveDotHeader" class="live-dot-header off"></div>
            <span id="liveTextHeader">Offline</span>
          </div>
        </div>
      </div>
      <div class="social-links">
        <a href="https://kick.com/n0chh" target="_blank" rel="noopener" title="Kick">
          <i class="fab fa-kick"></i>
        </a>
        <a href="https://instagram.com/n0chh" target="_blank" rel="noopener" title="Instagram">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://discord.com/invite/YSHJbNV" target="_blank" rel="noopener" title="Discord">
          <i class="fab fa-discord"></i>
        </a>
      </div>
    </div>

    <header>
      <div class="logo">KS</div>
      <div style="flex:1">
        <h1>n0chh Kick Live Stats — Top Chatter</h1>
        <div class="sub">Real-time chat stats · Top chatters · Emotes</div>
        <div class="raffle-rules">
          <div class="raffle-title">🎉 Top Chatter Raffle Rules</div>

          <ul>
            <li>The top 1 chatter each day for a full week will automatically enter the raffle.</li>
            <li>The prize includes real cash, so make sure to follow the rules carefully.</li>
            <li>Do not overuse emojis; excessive emoji use will disqualify you from the competition, and another participant will take your place.</li>
            <li>Respect all other community guidelines and terms.</li>
          </ul>
        </div>
      </div>
      <div class="live-indicator">
        <div id="liveDot" class="live-dot off"></div>
        <span id="liveText">Offline</span>
      </div>
    </header>

    <div class="card">
      <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px">
        <div>
          <div class="small">Channel: <strong id="channelNameDisplay">n0chh</strong></div>
          <div class="small">Started: <span id="sessionStart">—</span></div>
        </div>
        <div style="text-align:right">
          <div class="small">Uptime</div>
          <div style="font-weight:800;font-size:20px" id="streamDuration">—</div>
        </div>
      </div>

      <div class="stats-row">
        <div class="stat-pill">
          <div class="num" id="totalMessages">0</div>
          <div class="small">Messages</div>
        </div>
      </div>

      <div class="big-title"><img src="https://i.ibb.co/nJq4Sph/image-removebg-preview-5.png" alt="Logo" style="height: 60px; vertical-align: middle; margin-right: 8px;"> Top 10 Chatters (Live)</div> 
      <div class="leaderboard-container">
        <div class="chatter-grid" id="topChattersGrid"></div>
      </div>

      <div class="big-title"><img src="https://i.ibb.co/nJq4Sph/image-removebg-preview-5.png" alt="Logo" style="height: 60px; vertical-align: middle; margin-right: 8px;"> Top 10 Chatters (Text vs Emotes)</div>
      <div class="text-emote-grid" id="textEmoteGrid"></div>

      <div class="big-title">🎭 Top Emotes</div>
      <div class="emote-cloud" id="emoteCloud"></div>

      <div class="footer">
        <span>Real Kick usernames</span>
        <span>Records: <span id="recordCount">0</span></span>
      </div>
    </div>
  </div>
  
  <!-- Popup for Top Chatters -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup-content">
      <div class="popup-header">
        <div class="popup-title">
          <img src="https://i.ibb.co/nJq4Sph/image-removebg-preview-5.png" alt="Logo" style="height: 60px; vertical-align: middle; margin-right: 8px;">
          Top Chatters
        </div>
        <button class="close-popup" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="popup-leaderboard" id="popupLeaderboard"></div>
    </div>
  </div>
<script>
(() => {
  const channelInput = document.getElementById('channelInput');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const clearBtn = document.getElementById('clearBtn');
  const popupBtn = document.getElementById('popupBtn');
  const closePopup = document.getElementById('closePopup');
  const popupOverlay = document.getElementById('popupOverlay');
  const popupLeaderboard = document.getElementById('popupLeaderboard');
  const channelNameDisplay = document.getElementById('channelNameDisplay');
  const sessionStartEl = document.getElementById('sessionStart');
  const totalMessagesEl = document.getElementById('totalMessages');
  const uniqueChattersEl = document.getElementById('uniqueChatters');
  const topChattersGrid = document.getElementById('topChattersGrid');
  const textEmoteGrid = document.getElementById('textEmoteGrid');
  const emoteCloud = document.getElementById('emoteCloud');
  const emoteMessagesEl = document.getElementById('emoteMessages');
  const textMessagesEl = document.getElementById('textMessages');
  const liveDot = document.getElementById('liveDot');
  const liveText = document.getElementById('liveText');
  const streamDurationEl = document.getElementById('streamDuration');
  const recordCountEl = document.getElementById('recordCount');
  
  // New elements for streamer header
  const streamerAvatar = document.getElementById('streamerAvatar');
  const streamerName = document.getElementById('streamerName');
  const streamerTitle = document.getElementById('streamerTitle');
  const viewCount = document.getElementById('viewCount');
  const liveDotHeader = document.getElementById('liveDotHeader');
  const liveTextHeader = document.getElementById('liveTextHeader');

  let kickWS = null;
  let channel = 'n0chh'; // Hardcoded to n0chh
  let chatroomId = null;
  let sessionStart = null;
  let streamStartTimestamp = null;
  let reconnectTimer = null;

  let messageCount = 0;
  const userCounts = new Map();
  const userTextCounts = new Map();
  const userEmoteCounts = new Map();
  const uniqueUserSet = new Set();
  const emoteCounts = new Map();
  let emoteMessageCount = 0;
  let textMessageCount = 0;
  let totalWords = 0;
  const records = [];

  const excludedKickBots = new Set([
    "babblechat","botrix","casterlabs","intrx","livebot","lottobot","logibot","mrbeefbot","notibot",
    "squadbot","babzbot","kickbot","kicklet","boostbot","kicktools","aerokick","streamlabs"
  ]);

  const kickWSUri = "wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=7.6.0&flash=false";

  function setLiveIndicator(v){
    if(v){ 
      liveDot.className = 'live-dot live'; 
      liveText.textContent = 'Live'; 
      liveDotHeader.className = 'live-dot-header live';
      liveTextHeader.textContent = 'Live';
    } else { 
      liveDot.className = 'live-dot off'; 
      liveText.textContent = 'Offline'; 
      liveDotHeader.className = 'live-dot-header off';
      liveTextHeader.textContent = 'Offline';
    }
  }

  const emojiRegex = /(\p{Extended_Pictographic}|\p{Emoji_Presentation})/gu;
  const colonEmoteRegex = /:([a-zA-Z0-9_+-]{2,50}):/g;
  const kickEmoteRegex = /\[emote:\d+:[a-zA-Z0-9_]+\]/g;

  function extractEmotes(content){
    const found = [];
    if(!content) return found;
    let m;
    while((m = colonEmoteRegex.exec(content)) !== null) found.push(`:${m[1]}:`);
    while((m = kickEmoteRegex.exec(content)) !== null) found.push(m[0]);
    const emojiMatches = content.match(emojiRegex);
    if(emojiMatches) emojiMatches.forEach(e => found.push(e));
    return found;
  }

  function isEmoteOnlyMessage(content) {
    if (!content) return true;
    const clean = content.trim();
    if (!clean) return true;

    let stripped = clean
      .replace(kickEmoteRegex, '')
      .replace(colonEmoteRegex, '')
      .replace(emojiRegex, '');

    return stripped.trim() === '';
  }

  function countWords(s){ return s?.trim() ? s.trim().split(/\s+/).filter(Boolean).length : 0; }

  function updateDerivedMetrics(){
    const elapsedMs = Date.now() - (sessionStart?.getTime() || Date.now());
    const minutes = Math.max(elapsedMs / 60000, 1/60);
    const wpm = Math.round(totalWords / minutes) || 0;
    const mpm = Math.round(messageCount / minutes) || 0;
  }

  const rankEmojis = {
    1: '🥇',
    2: '🥈',
    3: '🥉',
    default: '🏅'
  };

  function rerenderTop(){
    const arr = Array.from(userCounts.entries()).sort((a,b)=>b[1]-a[1]);
    const top = arr.slice(0, 10);

    topChattersGrid.innerHTML = '';
    top.forEach(([username, count], index) => {
      const rank = index + 1;
      const card = document.createElement('div');
      card.className = `chatter-card rank-${rank <= 3 ? rank : 'default'}`;
      card.innerHTML = `
        <div>
          <div class="username">
            ${rankEmojis[rank <= 3 ? rank : 'default']} ${escapeHtml(username)}
          </div>
        </div>
        <div>
          <span class="message-count">${count.toLocaleString()}</span>
          <div class="rank-badge">${rank}</div>
        </div>
      `;
      topChattersGrid.appendChild(card);
    });

   popupLeaderboard.innerHTML = '';
top.slice(0, 5).forEach(([username, count], index) => {
  const rank = index + 1;
  const listItem = document.createElement('div');
  listItem.className = `chatter-card rank-${rank}`;
  listItem.style.marginBottom = '12px';
  listItem.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
      <div style="display:flex;align-items:center;gap:12px;">
        <span style="font-size:64px;">${rankEmojis[rank]}</span>
        <span class="username" style="font-size:30px;">${escapeHtml(username)}</span>
      </div>
      <span class="message-count" style="font-size:48px;">${count.toLocaleString()}</span>
    </div>
  `;
  popupLeaderboard.appendChild(listItem);
});
    textEmoteGrid.innerHTML = '';
    top.forEach(([username], index) => {
      const rank = index + 1;
      const textCount = userTextCounts.get(username) || 0;
      const emoteCount = userEmoteCounts.get(username) || 0;

      let cardClass = 'text-emote-card';
      if (rank <= 3) cardClass += ` rank-${rank}`;
      if (textCount > emoteCount) {
        cardClass += ' text-dominant';
      } else if (emoteCount > textCount) {
        cardClass += ' emote-dominant';
      }

      const card = document.createElement('div');
      card.className = cardClass;
      card.innerHTML = `
        <div class="rank-number">${rank}</div>
        <div class="text-emote-content">
          <div class="user-name">${escapeHtml(username)}</div>
          <div><span class="label">Text:</span> <span class="value">${textCount.toLocaleString()}</span></div>
          <div><span class="label">Emotes:</span> <span class="value">${emoteCount.toLocaleString()}</span></div>
        </div>
      `;
      textEmoteGrid.appendChild(card);
    });

    const emArr = Array.from(emoteCounts.entries()).sort((a,b)=>b[1]-a[1]).slice(0,20);
    emoteCloud.innerHTML = '';
    emArr.forEach(([em, count]) => {
      const span = document.createElement('span');
      span.className = 'emote-pill';
      span.innerHTML = `<i class="fa-regular fa-face-smile"></i> ${em} ×${count}`;
      emoteCloud.appendChild(span);
    });

    totalMessagesEl.innerText = messageCount.toLocaleString();
    uniqueChattersEl.innerText = uniqueUserSet.size.toLocaleString();
    emoteMessagesEl.innerText = emoteMessageCount.toLocaleString();
    textMessagesEl.innerText = textMessageCount.toLocaleString();
    recordCountEl.innerText = records.length.toLocaleString();
    updateDerivedMetrics();
  }

  function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, m => ({ '&':'&amp;','<':'<','>':'>','"':'&quot;',"'":'&#39;' }[m])); }

  function handleChatMessage(messageData){
    try{
      const sender = messageData.sender;
      const content = messageData.content || '';
      if(!sender?.username) return;
      const username = String(sender.username).trim();
      if(excludedKickBots.has(username.toLowerCase())) return;

      messageCount++;
      uniqueUserSet.add(username);

      const isEmoteOnly = isEmoteOnlyMessage(content);
      const words = countWords(content);
      totalWords += words;

      if(isEmoteOnly){
        emoteMessageCount++;
        userEmoteCounts.set(username, (userEmoteCounts.get(username)||0) + 1);
        const emotes = extractEmotes(content);
        emotes.forEach(e => emoteCounts.set(e, (emoteCounts.get(e)||0) + 1));
      } else {
        textMessageCount++;
        const newTextCount = (userTextCounts.get(username) || 0) + 1;
        userTextCounts.set(username, newTextCount);
        userCounts.set(username, newTextCount);
      }

      records.push({ ts: Date.now(), username, msg: content });
      if(records.length > 50000) records.shift();
      rerenderTop();
    }catch(e){ console.error(e); }
  }

  async function startListening(){
    channel = 'n0chh'; // Always use n0chh
    channelNameDisplay.innerText = channel;
    sessionStart = new Date();
    sessionStartEl.innerText = sessionStart.toLocaleTimeString();
    streamDurationEl.innerText = '--:--:--';
    setLiveIndicator(false);

    try{
      const res = await fetch(`https://kick.com/api/v2/channels/${encodeURIComponent(channel)}`);
      if(!res.ok) throw new Error('Channel not found');
      const data = await res.json();
      
      // Update streamer header with API data
      streamerName.textContent = data.user.username || 'n0chh';
      streamerTitle.textContent = data.livestream?.session_title || '—';
      viewCount.textContent = data.livestream?.viewer_count?.toLocaleString() || '0';
      
      if(data.user.profile_pic){
        streamerAvatar.src = data.user.profile_pic;
      }
      
      if(!data.chatroom?.id) throw new Error('Chatroom unavailable');
      chatroomId = data.chatroom.id;
      if(data.livestream?.created_at){
        streamStartTimestamp = new Date(data.livestream.created_at).getTime();
        setLiveIndicator(!!data.livestream.is_live);
      } else {
        setLiveIndicator(false);
      }
    }catch(err){
      console.error('Error loading channel data:', err);
      // Keep default values if API fails
      streamerName.textContent = 'n0chh';
      streamerTitle.textContent = '—';
      viewCount.textContent = '0';
      setLiveIndicator(false);
      return;
    }

    connectWebSocket();
  }

  function stopListening(){
    if(kickWS){ kickWS.close(); kickWS = null; }
    if(reconnectTimer) clearTimeout(reconnectTimer);
    setLiveIndicator(false);
  }

  function connectWebSocket(){
    if(kickWS) kickWS.close();
    kickWS = new WebSocket(kickWSUri);
    kickWS.onopen = () => {
      kickWS.send(JSON.stringify({ event: "pusher:subscribe", data: { auth: "", channel: `chatrooms.${chatroomId}.v2` } }));
      sessionStart = sessionStart || new Date();
      sessionStartEl.innerText = sessionStart.toLocaleTimeString();
      startUptimeTimer();
    };
    kickWS.onclose = () => { reconnectTimer = setTimeout(connectWebSocket, 5000); };
    kickWS.onmessage = (ev) => {
      try{
        const data = JSON.parse(ev.data);
        if(data.event?.includes('ChatMessageEvent')){
          let payload = data.data;
          if(typeof payload === 'string') payload = JSON.parse(payload);
          if(payload?.data && typeof payload.data === 'string') payload = JSON.parse(payload.data);
          const msg = payload?.message || payload;
          if(msg.sender && msg.content !== undefined) handleChatMessage(msg);
        }
      }catch(e){}
    };
  }

  let uptimeInterval = null;
  function startUptimeTimer(){
    if(uptimeInterval) clearInterval(uptimeInterval);
    uptimeInterval = setInterval(()=>{
      if(streamStartTimestamp){
        const elapsed = Date.now() - streamStartTimestamp;
        const hh = String(Math.floor(elapsed / 3600000)).padStart(2,'0');
        const mm = String(Math.floor(elapsed % 3600000 / 60000)).padStart(2,'0');
        const ss = String(Math.floor(elapsed % 60000 / 1000)).padStart(2,'0');
        streamDurationEl.innerText = `${hh}:${mm}:${ss}`;
      } else {
        streamDurationEl.innerText = '--:--:--';
      }
    }, 1000);
  }

  function clearSession(){
    if(!confirm('Clear all session data?')) return;
    messageCount = 0;
    userCounts.clear(); userTextCounts.clear(); userEmoteCounts.clear();
    uniqueUserSet.clear(); emoteCounts.clear();
    emoteMessageCount = 0; textMessageCount = 0; totalWords = 0;
    records.length = 0;
    rerenderTop();
  }

  // Auto-start for n0chh
  startListening();

  popupBtn.onclick = () => { popupOverlay.classList.add('active'); };
  closePopup.onclick = () => { popupOverlay.classList.remove('active'); };
  popupOverlay.onclick = (e) => { if(e.target === popupOverlay) popupOverlay.classList.remove('active'); };

  // Remove control buttons since we're hardcoded to n0chh
  const controls = document.querySelector('.controls');
  if(controls) controls.remove();

  channelNameDisplay.innerText = 'n0chh';
  rerenderTop();
})();
</script>
</body>
</html>
